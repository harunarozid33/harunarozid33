<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kategori Produk - Toko Material</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: 'Inter', sans-serif; }
    .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,.05); }
    .nav-link.active { font-weight: bold; border-bottom: 2px solid white; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#"><i class="fas fa-tools me-2"></i>Toko Material</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="dashboard-admin.html">Admin</a></li>
        <li class="nav-item"><a class="nav-link" href="produk.html">Produk</a></li>
        <li class="nav-item"><a class="nav-link active" href="kategori.html">Kategori</a></li>
        <li class="nav-item"><a class="nav-link" href="laporan.html">Laporan</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row g-4">
    <div class="col-md-4">
      <div class="card p-4">
        <h5 class="fw-bold mb-3 text-secondary">Tambah Kategori</h5>
        <div class="mb-3">
          <label class="form-label">Nama Kategori</label>
          <input type="text" id="nama_kategori" class="form-control" placeholder="Misal: Alat Listrik">
        </div>
        <button onclick="tambah()" class="btn btn-primary w-100 fw-bold">
          <i class="fas fa-save me-1"></i> Simpan
        </button>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold m-0 text-secondary">Daftar Kategori</h5>
          <span class="badge bg-primary px-3 py-2" id="countBadge">0 Kategori</span>
        </div>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th width="80">ID</th>
                <th>Nama Kategori</th>
                <th width="150" class="text-center">Aksi</th>
              </tr>
            </thead>
            <tbody id="data">
              </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalEdit" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Ubah Nama Kategori</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="edit_id">
        <div class="mb-3">
          <label class="form-label">Nama Kategori</label>
          <input type="text" id="edit_nama" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" onclick="update()" class="btn btn-primary">Simpan Perubahan</button>
      </div>
    </div>
  </div>
</div>

<script>
const API = "http://localhost/toko-material/api/api.php/records/kategori";
let editModal;

document.addEventListener("DOMContentLoaded", () => {
  editModal = new bootstrap.Modal(document.getElementById('modalEdit'));
  loadData();
});

function loadData() {
  fetch(API)
    .then(res => res.json())
    .then(result => {
      let tbody = document.getElementById("data");
      tbody.innerHTML = "";
      let records = result.records || [];
      document.getElementById("countBadge").innerText = `${records.length} Kategori`;

      if (records.length === 0) {
        tbody.innerHTML = "<tr><td colspan='3' class='text-center p-4 text-muted'>Belum ada kategori</td></tr>";
        return;
      }

      records.forEach(k => {
        tbody.innerHTML += `
          <tr>
            <td class="text-muted small">#${k.id}</td>
            <td class="fw-semibold">${k.nama_kategori}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-info text-white me-1" onclick="openEdit(${k.id}, '${k.nama_kategori}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger" onclick="hapus(${k.id})">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      });
    });
}

function tambah() {
  let nama = document.getElementById("nama_kategori").value;
  if (!nama) return alert("Nama tidak boleh kosong");

  fetch(API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nama_kategori: nama })
  }).then(() => {
    document.getElementById("nama_kategori").value = "";
    loadData();
  });
}

function openEdit(id, nama) {
  document.getElementById("edit_id").value = id;
  document.getElementById("edit_nama").value = nama;
  editModal.show();
}

function update() {
  let id = document.getElementById("edit_id").value;
  let nama = document.getElementById("edit_nama").value;
  
  fetch(`${API}/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nama_kategori: nama })
  }).then(() => {
    editModal.hide();
    loadData();
  });
}

function hapus(id) {
  if (!confirm("Hapus kategori ini? Produk dengan kategori ini mungkin akan terpengaruh.")) return;
  fetch(`${API}/${id}`, { method: "DELETE" }).then(() => loadData());
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>